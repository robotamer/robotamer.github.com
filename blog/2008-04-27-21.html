<!doctype html>
<html lang="en">
  <head>
  <title>Zend ACL</title>
  <meta name="description" content="Zend ACL plugin with sqlite backend">
  <meta name="keywords" content="RoboTamer">
  <meta name="generator" content="Hugo">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta http-equiv="cache-control" content="public">
  <meta http-equiv="content-language" content="en">
  <meta charset="UTF-8">
  <link rel="icon" href="http://www.robotamer.com/static/ico/favicon.ico" type="image/x-icon">
    <link href="http://www.robotamer.com/static/css/bootstrap.min.css" rel="stylesheet"/>
    <link href="http://www.robotamer.com/static/css/styles.css" rel="stylesheet"/>
    <link href="http://www.robotamer.com/static/css/hugoicon.css" rel="stylesheet"/>


  <link rel="alternate" type="application/rss+xml" title="RoboTamer (RSS 2.0)" href="http://www.robotamer.com/blog.xml">
  </head>
  <body>
<nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  
  <div class="navbar-header">
    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
      <span class="sr-only">Toggle navigation</span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
    <a class="navbar-brand" href="http://www.robotamer.com/"><img src="/static/img/robotamer.gif" alt="Logo" width="20" height="25">&nbsp; RoboTamer</a>
  </div>

  
  <div class="collapse navbar-collapse navbar-ex1-collapse">
    <ul class="nav navbar-nav">
    
      <li><a href="http://www.robotamer.com/blog.html">&nbsp; Blog &nbsp;</a></li>
      
      <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Linux <b class="caret"></b></a>
        <ul class="dropdown-menu">
            
            <li hugo-nav="/linux/bash/history.html"><a href="http://www.robotamer.com/linux/bash/history.html"> History </a> </li>
            
            <li hugo-nav="/blog/2011-06-01-nohub.html"><a href="http://www.robotamer.com/blog/2011-06-01-nohub.html"> nohub </a> </li>
            
            <li hugo-nav="/linux/index.html"><a href="http://www.robotamer.com/linux/index.html"> Linux Index </a> </li>
            
            <li hugo-nav="/linux/snippets.html"><a href="http://www.robotamer.com/linux/snippets.html"> Linux Snippets </a> </li>
            
            <li hugo-nav="/linux/nsr.html"><a href="http://www.robotamer.com/linux/nsr.html"> Network Safety Restart Bash Script </a> </li>
            
            <li hugo-nav="/code/md-syntax.html"><a href="http://www.robotamer.com/code/md-syntax.html"> Markdown Syntax </a> </li>
            
            <li hugo-nav="/linux/openssl/ssh.html"><a href="http://www.robotamer.com/linux/openssl/ssh.html"> ssh authorization </a> </li>
            
            <li hugo-nav="/linux/lxc.html"><a href="http://www.robotamer.com/linux/lxc.html"> Linux Containers </a> </li>
            
            <li hugo-nav="/linux/git.html"><a href="http://www.robotamer.com/linux/git.html"> Git Howto </a> </li>
            
            <li hugo-nav="/linux/bridge-utils.html"><a href="http://www.robotamer.com/linux/bridge-utils.html"> Bridge-Utils for LXC </a> </li>
            
            <li hugo-nav="/linux/openssl/mail-server-fingerprint.html"><a href="http://www.robotamer.com/linux/openssl/mail-server-fingerprint.html"> Mail Server Fingerprint </a> </li>
            
            <li hugo-nav="/linux/logrotate.html"><a href="http://www.robotamer.com/linux/logrotate.html"> Log Rotate </a> </li>
            
            <li hugo-nav="/linux/mail/msmtp.html"><a href="http://www.robotamer.com/linux/mail/msmtp.html"> msmtp </a> </li>
            
            <li hugo-nav="/linux/openssl/ca-cert.html"><a href="http://www.robotamer.com/linux/openssl/ca-cert.html"> Self-Signed SSL Certificate </a> </li>
            
            <li hugo-nav="/linux/openssl/ca-cert-cfg.html"><a href="http://www.robotamer.com/linux/openssl/ca-cert-cfg.html"> Self-Signed SSL Certificate with Config File </a> </li>
            
            <li hugo-nav="/linux/utf-8.html"><a href="http://www.robotamer.com/linux/utf-8.html"> UTF-8 Character List </a> </li>
            
            <li hugo-nav="/linux/mail/sendmail.html"><a href="http://www.robotamer.com/linux/mail/sendmail.html"> Send mail with sendmail </a> </li>
            
        </ul>
      </li>
      <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Go <b class="caret"></b></a>
        <ul class="dropdown-menu">
            
            <li hugo-nav="/code/go/gotamer/mail.html"><a href="http://www.robotamer.com/code/go/gotamer/mail.html"> Smtp </a> </li>
            
            <li hugo-nav="/code/go/gotamer/ping.html"><a href="http://www.robotamer.com/code/go/gotamer/ping.html"> Ping </a> </li>
            
            <li hugo-nav="/code/go/gotamer/sbs.html"><a href="http://www.robotamer.com/code/go/gotamer/sbs.html"> sbs </a> </li>
            
            <li hugo-nav="/code/go/gotamer/session.html"><a href="http://www.robotamer.com/code/go/gotamer/session.html"> Session </a> </li>
            
            <li hugo-nav="/code/go/gotamer/tools.html"><a href="http://www.robotamer.com/code/go/gotamer/tools.html"> Tools </a> </li>
            
            <li hugo-nav="/code/go/index.html"><a href="http://www.robotamer.com/code/go/index.html"> ﻿Snippets </a> </li>
            
            <li hugo-nav="/code/go/gotamer/jgdb.html"><a href="http://www.robotamer.com/code/go/gotamer/jgdb.html"> jgdb </a> </li>
            
            <li hugo-nav="/code/go/gotamer/crypt.html"><a href="http://www.robotamer.com/code/go/gotamer/crypt.html"> Crypt </a> </li>
            
            <li hugo-nav="/code/go/gotamer/cfg.html"><a href="http://www.robotamer.com/code/go/gotamer/cfg.html"> Cfg </a> </li>
            
            <li hugo-nav="/code/go/gotamer/cases.html"><a href="http://www.robotamer.com/code/go/gotamer/cases.html"> Cases </a> </li>
            
            <li hugo-nav="/code/go/gotamer/gowatch.html"><a href="http://www.robotamer.com/code/go/gotamer/gowatch.html"> GoWatch </a> </li>
            
            <li hugo-nav="/code/go/gotamer/index.html"><a href="http://www.robotamer.com/code/go/gotamer/index.html"> Gophy </a> </li>
            
            <li hugo-nav="/linux/utf-8.html"><a href="http://www.robotamer.com/linux/utf-8.html"> UTF-8 Character List </a> </li>
            
        </ul>
      </li>
      <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">PHP <b class="caret"></b></a>
        <ul class="dropdown-menu">
            
            <li hugo-nav="/code/php/read-folder.html"><a href="http://www.robotamer.com/code/php/read-folder.html"> Read Folder </a> </li>
            
            <li hugo-nav="/code/php/autoload.html"><a href="http://www.robotamer.com/code/php/autoload.html"> Autoload </a> </li>
            
            <li hugo-nav="/blog/2012-06-27-messenger-laravel-framework.html"><a href="http://www.robotamer.com/blog/2012-06-27-messenger-laravel-framework.html"> Messenger </a> </li>
            
            <li hugo-nav="/code/php/2011-06-20-multiple-php-installations-so-you-can-run-5-3-x-on-one-box.html"><a href="http://www.robotamer.com/code/php/2011-06-20-multiple-php-installations-so-you-can-run-5-3-x-on-one-box.html"> Multiple PHP installations </a> </li>
            
            <li hugo-nav="/blog/2011-06-01-echo.html"><a href="http://www.robotamer.com/blog/2011-06-01-echo.html"> e() for echo </a> </li>
            
            <li hugo-nav="/blog/2008-04-27-21.html"><a href="http://www.robotamer.com/blog/2008-04-27-21.html"> Zend ACL </a> </li>
            
            <li hugo-nav="/code/php/phptamer/index.html"><a href="http://www.robotamer.com/code/php/phptamer/index.html"> PHPTamer </a> </li>
            
            <li hugo-nav="/code/php/phptamer/rtsingleton.html"><a href="http://www.robotamer.com/code/php/phptamer/rtsingleton.html"> Singleton </a> </li>
            
            <li hugo-nav="/code/php/phptamer/rtcrypter.html"><a href="http://www.robotamer.com/code/php/phptamer/rtcrypter.html"> Crypter </a> </li>
            
            <li hugo-nav="/code/php/phptamer/facade.html"><a href="http://www.robotamer.com/code/php/phptamer/facade.html"> Facade </a> </li>
            
            <li hugo-nav="/linux/utf-8.html"><a href="http://www.robotamer.com/linux/utf-8.html"> UTF-8 Character List </a> </li>
            
        </ul>
      </li>

    </ul>

    <ul class="nav navbar-nav navbar-right">
      <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown"><img src="/static/ico/i.png" alt="info" width="20" height="20"> <b class="caret"></b></a>
        <ul class="dropdown-menu">
            
            <li hugo-nav="/about.html"><a href="http://www.robotamer.com/about.html"> About </a> </li>
            
            <li hugo-nav="/license.html"><a href="http://www.robotamer.com/license.html"> © Copyright </a> </li>
            
            <li><a href="http://www.robotamer.com/feeds.html"><img src="/static/ico/feed16x16.png" alt="Feeds" width="16" height="16"> Feeds</a></li>
        </ul>
      </li>
      <li><a href="http://bitbucket.org/robotamer"><i class="icon-octocat icon-2x"> </i></a></li>

    </ul>
  </div>
</nav>

    <div class="container">
      <div class="row">
        <div class="col-md-12">




<div class="panel panel-default">
  <div class="panel-heading">
  	<h2>Zend ACL</h2>
	<h4>Zend ACL plugin with sqlite backend</h4>
	<h5>Sun, Apr 27, 2008</h5>
  </div>
  <div class="panel-body">
	<p>Tamer_ACL is a simple Zend Framework ACL plugin that uses the sqlite backend to store all the data.</p>

<h4>How To Inatall</h4>

<p>Make sure you have a table called <strong>role</strong> in your authentication table and a table called <strong>alias</strong> you may change that to username if you like. The sql code is below.<br />
Below are the files.<br />
Before each file you will find installation instructions that should work even for the most novice Linux / Zend Framework developer.</p>

<h4>Resources</h4>

<ul>
<li><a href="http://www.phpclasses.org/browse/package/4100.html">phpclasses.org</a><br /></li>
<li><a href="http://code.google.com/p/tamer">Google code / REPO</a><br /></li>
</ul>

<h4>Todo</h4>

<ul>
<li>Admin Backend<br /></li>
</ul>

<hr />

<h4>ZEND_ROOT/backstrap.php</h4>

<p>Create acl object</p>

<pre><code class="php">include_once &quot;Tamer/Acl.php&quot;;
$acl = new Tamer_Acl();
</code></pre>

<p>Add the Tamer_Plugin_Auth to the Zend Front Controller</p>

<pre><code class="php">$front-&gt;setControllerDirectory(APPS . '/default/controllers')
        -&gt;setBaseUrl($cfg-&gt;baseUrl)
        -&gt;registerPlugin(new Tamer_Plugin_Auth($auth, $acl))
</code></pre>

<h4>ZEND_ROOT/library/Tamer/Acl.php</h4>

<pre><code class="php">
&lt;?php
require_once 'Zend/Acl.php';
require_once 'Zend/Acl/Role.php';
require_once 'Zend/Acl/Resource.php';
require_once 'Zend/Db/Adapter/Pdo/Sqlite.php';

class Tamer_ACL extends Zend_ACL 
{
        public $alias;
        public $role;
        
        public function __construct($alias, $role)
        {       
                $this-&gt;alias = $alias;
                $this-&gt;role = $role;
                $sqlite = new TamerLiteACL($alias, $role);
                $result = $sqlite-&gt;getAclRows();
                foreach($result['roles'] as $v){
                        $this-&gt;addRoles($v);
                }
                $this-&gt;addResources($result['resources']);
                $this-&gt;addAccess($result['access']);
        }
        
        private function addRoles($rows)
        {
                foreach($rows as $v){
                        if($v['parent'] == ''){
                                $this-&gt;addRole(new Zend_Acl_Role($v['role']));
                        }else{
                                $this-&gt;addRole(new Zend_Acl_Role($v['role']), $v['parent']);
                        }
                }
        }
        
        private function addResources($rows)
        {
                foreach($rows as $v){
                        if($v['parent'] == ''){
                                $this-&gt;add(new Zend_Acl_Resource($v['resource']));
                        }else{
                                $this-&gt;add(new Zend_Acl_Resource($v['resource']), $v['parent']);
                        }
                }
        }

        private function addAccess($rows)
        {
                foreach($rows as $v){
                        if($v['allow'] == 1){
                                $this-&gt;allow($v['role'], $v['resource'], $v['privilege']);
                        }else{
                                $this-&gt;deny($v['role'], $v['resource'], $v['privilege']);
                        }
                }
        }
}


class TamerLiteACL 
{
        private $_sqlite_name = '/db/config.db';
        private $_alias;
        private $_role;
        private $_result;
        
        public function __construct($alias, $role)
        {       
                $this-&gt;_alias = $alias;
                $this-&gt;_role = $role;
                
                try{
                        $this-&gt;_sqliteAdapter = new Zend_Db_Adapter_Pdo_Sqlite(array('dbname' =&gt; ROOT.$this-&gt;_sqlite_name));
                        $this-&gt;_sqliteAdapter-&gt;getConnection();
                } catch (Zend_Db_Adapter_Exception $e) {
                        echo 'adapter&lt;pre&gt;'.$e-&gt;getMessage().'&lt;/pre&gt;';
                } catch (Zend_Exception $e) {
                        echo 'adapter&lt;pre&gt;'.$e-&gt;getMessage().'&lt;/pre&gt;';
                }
                $this-&gt;_sqliteAdapter-&gt;getProfiler()-&gt;setEnabled(true);

                $select = $this-&gt;_sqliteAdapter-&gt;select()
                                        -&gt;from('acl_roles', array('role', 'parent'))
                                        -&gt;where('type = ?', 1);
                
                $stmt = $this-&gt;_sqliteAdapter-&gt;query($select);
                $this-&gt;_result['roles']['system'] = $stmt-&gt;fetchAll();
                
                $select = $this-&gt;_sqliteAdapter-&gt;select()
                                        -&gt;from('acl_roles', array('role', 'parent'))
                                        -&gt;where('role = ?', $this-&gt;_alias)
                                        -&gt;orwhere('parent = ?', $this-&gt;_alias);
                
                $stmt = $this-&gt;_sqliteAdapter-&gt;query($select);
                $this-&gt;_result['roles']['alias'] = $stmt-&gt;fetchAll();
                
                $stmt = $this-&gt;_sqliteAdapter-&gt;query(
                &quot;SELECT resource, parent FROM acl_resources WHERE owner = 'system' OR owner = ?&quot;, $this-&gt;_alias);
                $this-&gt;_result['resources'] = $rows = $stmt-&gt;fetchAll();
                
                $stmt = $this-&gt;_sqliteAdapter-&gt;query('SELECT allow, role, resource, privilege FROM acl_access WHERE type = 1 ORDER BY chain');
                $this-&gt;_result['access'] = $rows = $stmt-&gt;fetchAll();

                $this-&gt;_sqliteAdapter-&gt;closeConnection();
        }
        
        public function getAclRows()
        {
                return $this-&gt;_result;
        }
}




class aclCreate extends Zend_ACL 
{
        public function __construct()
        {
                $this-&gt;add(new Zend_Acl_Resource('index'));
                $this-&gt;add(new Zend_Acl_Resource('safe'));
                $this-&gt;add(new Zend_Acl_Resource('login'), 'safe');
                $this-&gt;add(new Zend_Acl_Resource('registration'), 'safe');
                $this-&gt;add(new Zend_Acl_Resource('password'), 'safe');
                
                $this-&gt;addRole(new Zend_Acl_Role('guest'));
                $this-&gt;deny('guest', 'safe', NULL);
                $this-&gt;allow('guest', 'registration');
                $this-&gt;allow('guest', 'login');
                $this-&gt;deny('guest', 'password');
                $this-&gt;allow('guest','index');
                
                $this-&gt;addRole(new Zend_Acl_Role('member'));
                $this-&gt;allow('member', 'safe', NULL);
                
                $this-&gt;addRole(new Zend_Acl_Role('admin'));
                $this-&gt;allow('admin');
        }

}

class TamerFile_ACL
{
        /*
        @ Call like this from bootstrap
                include_once &quot;Tamer/Acl.php&quot;;
                $acl = new Tamer_Acl();
                $acl = new aclCreate();
                $acl = $acl-&gt;aclCheck();
        */
        protected $aclCfg;
        
        private $_sqlite_name = '/db/config.db';
        private $_sqliteAdapter;
        private $_table; //Sqlite Table
        
        public $old = FALSE;

        public function __construct()
        {
                $this-&gt;aclCfg = ROOT.'/library/Tamer/Acl.php';

                try{
                        $this-&gt;_sqliteAdapter = new Zend_Db_Adapter_Pdo_Sqlite(array('dbname' =&gt; ROOT.$this-&gt;_sqlite_name));
                        $this-&gt;_sqliteAdapter-&gt;getConnection();
                } catch (Zend_Db_Adapter_Exception $e) {
                        echo 'adapter&lt;pre&gt;'.$e-&gt;getMessage().'&lt;/pre&gt;';
                } catch (Zend_Exception $e) {
                        echo 'adapter&lt;pre&gt;'.$e-&gt;getMessage().'&lt;/pre&gt;';
                }
                //$this-&gt;dropTable();
                //$this-&gt;makeTable();
                //$this-&gt;aclCheck();
        }
        
        public function aclCheck()
        {
                $ftime = filemtime($this-&gt;aclCfg);
                $sql = 'SELECT time FROM acl_array WHERE time = ?';
                if($this-&gt;_result = $this-&gt;_sqliteAdapter-&gt;fetchRow($sql, $ftime)){     
                        return  $this-&gt;aclGet();
                }else{
                        $acl = new aclCreate();
                        $this-&gt;aclDelete();
                        $this-&gt;aclSave($acl);
                        return $acl;
                }
        }

        public function aclGet()
        {
                $sql = 'SELECT acl FROM acl_array WHERE time = ?';
                $ftime = filemtime($this-&gt;aclCfg);
                $this-&gt;_result = $this-&gt;_sqliteAdapter-&gt;fetchRow($sql, $ftime);
                $this-&gt;_sqliteAdapter-&gt;closeConnection();
                
                return unserialize($this-&gt;_result['acl']);
        }
        
        public function aclSave($array)
        {
                $filemtime = filemtime($this-&gt;aclCfg);
                $array = serialize($array);
                $data = array('time'=&gt;$filemtime,'acl'=&gt;$array);
                $this-&gt;_sqliteAdapter-&gt;insert('acl_array', $data);
                $this-&gt;_sqliteAdapter-&gt;closeConnection();
        }

        public function aclDelete()
        {
                $this-&gt;_sqliteAdapter-&gt;delete('acl_array');
                $this-&gt;_sqliteAdapter-&gt;closeConnection();
        }

        
        /**
         * creates the db table
         *
         * @param array $fields
         */
        public function dropTable()
        {
            $this-&gt;_result = $this-&gt;_sqliteAdapter-&gt;getConnection()-&gt;exec('DROP TABLE acl_array');
                $this-&gt;_sqliteAdapter-&gt;closeConnection();
        }
        
        /**
         * creates the db table
         *
         * @param array $fields
         */
        public function makeTable()
        {
                $sql[] = 'CREATE TABLE IF NOT EXISTS acl_roles (role TEXT(50) NOT NULL,parent TEXT(50) default NULL)';
                $sql[] = 'CREATE TABLE IF NOT EXISTS acl_resources (resource TEXT(50) NOT NULL,parent TEXT(50) default NULL)';
                $sql[] = 'CREATE TABLE IF NOT EXISTS acl_access (role TEXT(50) NOT NULL,resource  Text(50) NOT NULL,privilege Text(50),allow Boolean NOT NULL DEFAULT 0)';
                $sql[] = 'CREATE table IF NOT EXISTS acl_array(time INTEGER PRIMARY KEY, acl TEXT)';
                foreach($sql as $v){
                        $this-&gt;_sqliteAdapter-&gt;query($v);
                }
                $this-&gt;_table = true;
                $this-&gt;_sqliteAdapter-&gt;closeConnection();
        }       
}
?&gt;
</code></pre>

<h4>ZEND_ROOT/library/Tamer/Plugin/Auth.php</h4>

<pre><code class="php">&lt;?php

class Tamer_Plugin_Auth extends Zend_Controller_Plugin_Abstract
{
        private $_auth;
        private $_acl;
        
        private $_noauth = array('module' =&gt; 'safe',
                                                        'controller' =&gt; 'login',
                                                        'action' =&gt; 'index');
        
        private $_noacl = array('module' =&gt; 'default',
                                                        'controller' =&gt; 'error',
                                                        'action' =&gt; 'privileges');
        
        public function __construct($auth, $acl)
        {
                $this-&gt;_auth = $auth;
                $this-&gt;_acl = $acl;
        }
        
        public function preDispatch(Zend_Controller_Request_Abstract $request)
        {
                if ($this-&gt;_auth-&gt;hasIdentity()) {
                        $role = $this-&gt;_auth-&gt;getIdentity()-&gt;role;
                } else {
                        $role = 'guest';
                }

                $controller = $request-&gt;controller;
                $action         = $request-&gt;action;
                $module         = $request-&gt;module;
                $resource       = $controller;
                
                if (!$this-&gt;_acl-&gt;has($resource)) {
                        $resource = null;
                }
                
                if (!$this-&gt;_acl-&gt;isAllowed($role, $resource, $action)) {
                        if (!$this-&gt;_auth-&gt;hasIdentity()) {
                                $module = $this-&gt;_noauth['module'];
                                $controller = $this-&gt;_noauth['controller'];
                                $action = $this-&gt;_noauth['action'];
                        } else {
                                $module = $this-&gt;_noacl['module'];
                                $controller = $this-&gt;_noacl['controller'];
                                $action = $this-&gt;_noacl['action'];
                        }
                }
                
                $request-&gt;setModuleName($module);
                $request-&gt;setControllerName($controller);
                $request-&gt;setActionName($action);
        }
}
?&gt;
</code></pre>

<h4>ZEND_ROOT/db/config.sql</h4>

<pre><code class="sql">DROP TABLE IF EXISTS acl_array;
DROP TABLE IF EXISTS acl_roles;
DROP TABLE IF EXISTS acl_resources;
DROP TABLE IF EXISTS acl_access;
DROP TRIGGER IF EXISTS update_acl_roles;
DROP TRIGGER IF EXISTS update_acl_roles_access;
DROP TRIGGER IF EXISTS update_acl_roles_parent;
DROP TRIGGER IF EXISTS update_acl_resources_owner;
DROP TRIGGER IF EXISTS update_acl_access_role;

PRAGMA auto_vacuum = 1;
PRAGMA encoding = &quot;UTF-8&quot;;

BEGIN TRANSACTION;
CREATE TABLE IF NOT EXISTS acl_roles (role TEXT(50) NOT NULL,parent TEXT(50) default NULL, type Boolean DEFAULT NULL);

CREATE TABLE IF NOT EXISTS acl_resources (owner TEXT(50) NOT NULL,
resource TEXT(50) NOT NULL,parent TEXT(50) default NULL);

CREATE TABLE IF NOT EXISTS acl_access (role TEXT(50) NOT NULL,
resource TEXT(50) DEFAULT NULL, privilege Text(50) DEFAULT NULL, 
allow Boolean DEFAULT NULL, chain INTEGER DEFAULT NULL, type Boolean DEFAULT NULL);

CREATE TRIGGER update_acl_roles_parent UPDATE OF parent ON acl_roles 
        BEGIN UPDATE acl_roles SET parent = new.role WHERE parent = old.role;
        END;
CREATE TRIGGER update_acl_resources_owner UPDATE OF owner ON acl_resources 
        BEGIN UPDATE acl_resources SET owner = new.role WHERE owner = old.role; 
        END;
CREATE TRIGGER update_acl_access_role UPDATE OF role ON acl_access 
        BEGIN UPDATE acl_access SET role = new.role WHERE role = old.role; 
        END;


INSERT INTO &quot;acl_roles&quot; VALUES ('admin',NULL,1);
INSERT INTO &quot;acl_roles&quot; VALUES ('guest',NULL,1);
INSERT INTO &quot;acl_roles&quot; VALUES ('member',NULL,1);
INSERT INTO &quot;acl_roles&quot; VALUES ('developer','member',1);

INSERT INTO &quot;acl_resources&quot; VALUES ('system','index',NULL);
INSERT INTO &quot;acl_resources&quot; VALUES ('system','safe',NULL);
INSERT INTO &quot;acl_resources&quot; VALUES ('system','login','safe');
INSERT INTO &quot;acl_resources&quot; VALUES ('system','registration','safe');
INSERT INTO &quot;acl_resources&quot; VALUES ('system','admin','safe');

INSERT INTO &quot;acl_access&quot; VALUES ('admin',NULL,NULL,1,NULL,1);
INSERT INTO &quot;acl_access&quot; VALUES ('guest','index',NULL,1,1,1);
INSERT INTO &quot;acl_access&quot; VALUES ('guest','safe',NULL,NULL,2,1);
INSERT INTO &quot;acl_access&quot; VALUES ('guest','login',NULL,1,3,1);
INSERT INTO &quot;acl_access&quot; VALUES ('guest','registration',NULL,1,4,1);
INSERT INTO &quot;acl_access&quot; VALUES ('member','safe',NULL,1,1,1);
INSERT INTO &quot;acl_access&quot; VALUES ('member','login',NULL,NULL,2,1);
INSERT INTO &quot;acl_access&quot; VALUES ('member','registration',NULL,NULL,3,1);
COMMIT;
</code></pre>

  </div>
  <div class="panel-footer">
    <div class="btn-group">
      
      <a href="http://www.robotamer.com/tags/code.html"><button type="button" class="btn btn-info btn-xs">code</button></a>	
      
      <a href="http://www.robotamer.com/tags/php.html"><button type="button" class="btn btn-info btn-xs">php</button></a>	
      
    </div>  
  </div>
</div>


        </div>
      </div>
    </div>

    <div class="container">
      <hr>
      <footer id="footer">
        Copyright &copy; 1998 - 2013 RoboTamer
        <span class="right">


          <a href="http://www.robotamer.com/blog.xml" rel="alternate" type="application/rss+xml">
            <img src="/static/ico/feed16x16.png" alt="" style="vertical-align:middle;border:0"/>
          </a>&nbsp;

          <a href="http://feedburner.google.com" target="_blank">
            <img src="//feedburner.google.com/fb/images/pub/powered_by_fb.gif" alt="Powered by FeedBurner" style="border:0"/>
          </a>

        </span>

      </footer>
    </div>
      <script src="/static/js/jquery.js"></script>
      <script src="/static/js/bootstrap.min.js"></script>
    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-33624274-1', 'robotamer.com');
  ga('send', 'pageview');
</script>

  </body>

</html>

