<!doctype html>
<html lang="en">
  <head>
  <title>Linux Containers</title>
  <meta name="description" content="Setting up and using Linux Containers (LXC) on Debian">
  <meta name="keywords" content="linux, howto, server, lxc, br, debian, Linux Containers, virtualization, RoboTamer">
  <meta name="generator" content="Hugo">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta http-equiv="cache-control" content="public">
  <meta http-equiv="content-language" content="en">
  <meta charset="UTF-8">
  <link rel="icon" href="http://www.robotamer.com/static/ico/favicon.ico" type="image/x-icon">
    <link href="http://www.robotamer.com/static/css/bootstrap.min.css" rel="stylesheet"/>
    <link href="http://www.robotamer.com/static/css/styles.css" rel="stylesheet"/>
    <link href="http://www.robotamer.com/static/css/hugoicon.css" rel="stylesheet"/>


  </head>
  <body>
<nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  
  <div class="navbar-header">
    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
      <span class="sr-only">Toggle navigation</span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
    <a class="navbar-brand" href="http://www.robotamer.com/"><img src="/static/img/robotamer.gif" alt="Logo" width="20" height="25">&nbsp; RoboTamer</a>
  </div>

  
  <div class="collapse navbar-collapse navbar-ex1-collapse">
    <ul class="nav navbar-nav">
    
      <li><a href="http://www.robotamer.com/blog.html">&nbsp; Blog &nbsp;</a></li>
      
      <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Linux <b class="caret"></b></a>
        <ul class="dropdown-menu">
            
            <li hugo-nav="/linux/bash/history.html"><a href="http://www.robotamer.com/linux/bash/history.html"> History </a> </li>
            
            <li hugo-nav="/blog/2011-06-01-nohub.html"><a href="http://www.robotamer.com/blog/2011-06-01-nohub.html"> nohub </a> </li>
            
            <li hugo-nav="/linux/index.html"><a href="http://www.robotamer.com/linux/index.html"> Linux Index </a> </li>
            
            <li hugo-nav="/linux/snippets.html"><a href="http://www.robotamer.com/linux/snippets.html"> Linux Snippets </a> </li>
            
            <li hugo-nav="/linux/nsr.html"><a href="http://www.robotamer.com/linux/nsr.html"> Network Safety Restart Bash Script </a> </li>
            
            <li hugo-nav="/code/md-syntax.html"><a href="http://www.robotamer.com/code/md-syntax.html"> Markdown Syntax </a> </li>
            
            <li hugo-nav="/linux/openssl/ssh.html"><a href="http://www.robotamer.com/linux/openssl/ssh.html"> ssh authorization </a> </li>
            
            <li hugo-nav="/linux/lxc.html"><a href="http://www.robotamer.com/linux/lxc.html"> Linux Containers </a> </li>
            
            <li hugo-nav="/linux/git.html"><a href="http://www.robotamer.com/linux/git.html"> Git Howto </a> </li>
            
            <li hugo-nav="/linux/bridge-utils.html"><a href="http://www.robotamer.com/linux/bridge-utils.html"> Bridge-Utils for LXC </a> </li>
            
            <li hugo-nav="/linux/openssl/mail-server-fingerprint.html"><a href="http://www.robotamer.com/linux/openssl/mail-server-fingerprint.html"> Mail Server Fingerprint </a> </li>
            
            <li hugo-nav="/linux/logrotate.html"><a href="http://www.robotamer.com/linux/logrotate.html"> Log Rotate </a> </li>
            
            <li hugo-nav="/linux/mail/msmtp.html"><a href="http://www.robotamer.com/linux/mail/msmtp.html"> msmtp </a> </li>
            
            <li hugo-nav="/linux/openssl/ca-cert.html"><a href="http://www.robotamer.com/linux/openssl/ca-cert.html"> Self-Signed SSL Certificate </a> </li>
            
            <li hugo-nav="/linux/openssl/ca-cert-cfg.html"><a href="http://www.robotamer.com/linux/openssl/ca-cert-cfg.html"> Self-Signed SSL Certificate with Config File </a> </li>
            
            <li hugo-nav="/linux/utf-8.html"><a href="http://www.robotamer.com/linux/utf-8.html"> UTF-8 Character List </a> </li>
            
            <li hugo-nav="/linux/mail/sendmail.html"><a href="http://www.robotamer.com/linux/mail/sendmail.html"> Send mail with sendmail </a> </li>
            
        </ul>
      </li>
      <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Go <b class="caret"></b></a>
        <ul class="dropdown-menu">
            
            <li hugo-nav="/code/go/gotamer/mail.html"><a href="http://www.robotamer.com/code/go/gotamer/mail.html"> Smtp </a> </li>
            
            <li hugo-nav="/code/go/gotamer/ping.html"><a href="http://www.robotamer.com/code/go/gotamer/ping.html"> Ping </a> </li>
            
            <li hugo-nav="/code/go/gotamer/sbs.html"><a href="http://www.robotamer.com/code/go/gotamer/sbs.html"> sbs </a> </li>
            
            <li hugo-nav="/code/go/gotamer/session.html"><a href="http://www.robotamer.com/code/go/gotamer/session.html"> Session </a> </li>
            
            <li hugo-nav="/code/go/gotamer/tools.html"><a href="http://www.robotamer.com/code/go/gotamer/tools.html"> Tools </a> </li>
            
            <li hugo-nav="/code/go/index.html"><a href="http://www.robotamer.com/code/go/index.html"> ﻿Snippets </a> </li>
            
            <li hugo-nav="/code/go/gotamer/jgdb.html"><a href="http://www.robotamer.com/code/go/gotamer/jgdb.html"> jgdb </a> </li>
            
            <li hugo-nav="/code/go/gotamer/crypt.html"><a href="http://www.robotamer.com/code/go/gotamer/crypt.html"> Crypt </a> </li>
            
            <li hugo-nav="/code/go/gotamer/cfg.html"><a href="http://www.robotamer.com/code/go/gotamer/cfg.html"> Cfg </a> </li>
            
            <li hugo-nav="/code/go/gotamer/cases.html"><a href="http://www.robotamer.com/code/go/gotamer/cases.html"> Cases </a> </li>
            
            <li hugo-nav="/code/go/gotamer/gowatch.html"><a href="http://www.robotamer.com/code/go/gotamer/gowatch.html"> GoWatch </a> </li>
            
            <li hugo-nav="/code/go/gotamer/index.html"><a href="http://www.robotamer.com/code/go/gotamer/index.html"> Gophy </a> </li>
            
            <li hugo-nav="/linux/utf-8.html"><a href="http://www.robotamer.com/linux/utf-8.html"> UTF-8 Character List </a> </li>
            
        </ul>
      </li>
      <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">PHP <b class="caret"></b></a>
        <ul class="dropdown-menu">
            
            <li hugo-nav="/code/php/read-folder.html"><a href="http://www.robotamer.com/code/php/read-folder.html"> Read Folder </a> </li>
            
            <li hugo-nav="/code/php/autoload.html"><a href="http://www.robotamer.com/code/php/autoload.html"> Autoload </a> </li>
            
            <li hugo-nav="/blog/2012-06-27-messenger-laravel-framework.html"><a href="http://www.robotamer.com/blog/2012-06-27-messenger-laravel-framework.html"> Messenger </a> </li>
            
            <li hugo-nav="/code/php/2011-06-20-multiple-php-installations-so-you-can-run-5-3-x-on-one-box.html"><a href="http://www.robotamer.com/code/php/2011-06-20-multiple-php-installations-so-you-can-run-5-3-x-on-one-box.html"> Multiple PHP installations </a> </li>
            
            <li hugo-nav="/blog/2011-06-01-echo.html"><a href="http://www.robotamer.com/blog/2011-06-01-echo.html"> e() for echo </a> </li>
            
            <li hugo-nav="/blog/2008-04-27-21.html"><a href="http://www.robotamer.com/blog/2008-04-27-21.html"> Zend ACL </a> </li>
            
            <li hugo-nav="/code/php/phptamer/index.html"><a href="http://www.robotamer.com/code/php/phptamer/index.html"> PHPTamer </a> </li>
            
            <li hugo-nav="/code/php/phptamer/rtsingleton.html"><a href="http://www.robotamer.com/code/php/phptamer/rtsingleton.html"> Singleton </a> </li>
            
            <li hugo-nav="/code/php/phptamer/rtcrypter.html"><a href="http://www.robotamer.com/code/php/phptamer/rtcrypter.html"> Crypter </a> </li>
            
            <li hugo-nav="/code/php/phptamer/facade.html"><a href="http://www.robotamer.com/code/php/phptamer/facade.html"> Facade </a> </li>
            
            <li hugo-nav="/linux/utf-8.html"><a href="http://www.robotamer.com/linux/utf-8.html"> UTF-8 Character List </a> </li>
            
        </ul>
      </li>

    </ul>

    <ul class="nav navbar-nav navbar-right">
      <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown"><img src="/static/ico/i.png" alt="info" width="20" height="20"> <b class="caret"></b></a>
        <ul class="dropdown-menu">
            
            <li hugo-nav="/about.html"><a href="http://www.robotamer.com/about.html"> About </a> </li>
            
            <li hugo-nav="/license.html"><a href="http://www.robotamer.com/license.html"> © Copyright </a> </li>
            
            <li><a href="http://www.robotamer.com/feeds.html"><img src="/static/ico/feed16x16.png" alt="Feeds" width="16" height="16"> Feeds</a></li>
        </ul>
      </li>
      <li><a href="http://bitbucket.org/robotamer"><i class="icon-octocat icon-2x"> </i></a></li>

    </ul>
  </div>
</nav>

    <div class="container">
      <div class="row">
        <div class="col-md-12">

<div class="panel panel-default">
  <div class="panel-heading">
  	<h2>Linux Containers</h2>
	<h4>Setting up and using Linux Containers (LXC) on Debian</h4>
  </div>
  <div class="panel-body">
  <p>Linux Containers provide a Free Software virtualization system for computers running GNU/Linux. This is accomplished through kernel level isolation. It allows one to run multiple virtual units simultaneously. Those units, similar to chroots, are sufficiently isolated to guarantee the required security, but utilize available resources efficiently, as they run on the same kernel.</p>

<pre><code>apt-get install lxc bridge-utils debootstrap
</code></pre>

<p>First we will setup our Bridge: <a href="Bridge-Utils.html">Linux:bridge-utils</a></p>

<p>/etc/fstab</p>

<pre><code>cgroup          /sys/fs/cgroup         cgroup  defaults        0       0

mount -a


LXCDIR=/var/lib/lxc
cd $LXCDIR
nano vm0.cfg
</code></pre>

<p>Following is a template config file. If you are also looking at other howto&rsquo;s, don&rsquo;t get coughed up at the fstab mount option. The debian script takes care of that. You will at leased have to change the IP address.</p>

<p><strong>vm0.cfg</strong></p>

<pre><code>lxc.utsname = vm0
lxc.rootfs = /var/lib/lxc/vm0/rootfs

lxc.tty = 4
lxc.network.type = veth
lxc.network.flags = up
lxc.network.link = br0
lxc.network.name = eth0
lxc.network.mtu = 1500

# security parameter
lxc.cgroup.devices.deny = a # Deny all access to devices
lxc.cgroup.devices.allow = c 1:3 rwm   # dev/null
lxc.cgroup.devices.allow = c 1:5 rwm   # dev/zero
lxc.cgroup.devices.allow = c 5:1 rwm   # dev/console
lxc.cgroup.devices.allow = c 5:0 rwm   # dev/tty
lxc.cgroup.devices.allow = c 4:0 rwm   # dev/tty0
lxc.cgroup.devices.allow = c 4:1 rwm   # dev/tty1
lxc.cgroup.devices.allow = c 4:2 rwm   # dev/tty2
lxc.cgroup.devices.allow = c 1:9 rwm   # dev/urandon
lxc.cgroup.devices.allow = c 1:8 rwm   # dev/random
lxc.cgroup.devices.allow = c 136:* rwm # dev/pts/*
lxc.cgroup.devices.allow = c 5:2 rwm   # dev/pts/ptmx
lxc.cgroup.devices.allow = c 254:0 rwm # dev/rtc

# mounts point
lxc.mount.entry=proc   /var/lib/lxc/vm0/rootfs/proc proc nodev,noexec,nosuid 0 0
lxc.mount.entry=devpts /var/lib/lxc/vm0/rootfs/dev/pts devpts defaults 0 0
lxc.mount.entry=sysfs  /var/lib/lxc/vm0/rootfs/sys sysfs defaults  0 0
</code></pre>

<p>Command</p>

<pre><code>lxc-create -f $LXCDIR/vm0.cfg -n vm0
cp /usr/lib/lxc/templates/lxc-debian $LXCDIR
</code></pre>

<p>At this point you might wont to make lxc-debian your own. At leased change the release from Lenny to Squeeze</p>

<pre><code>./lxc-debian -p vm0
</code></pre>

<p>The vm0 should have been created now. Your root password is root.
Before we start it up we will make some config changes.</p>

<p>First edit your network config</p>

<pre><code>nano $LXCDIR/vm0/rootfs/etc/network/interfaces
</code></pre>

<p>File needs to look like this: // Note change the IP addresses to yours, if you don&rsquo;t know how, you know you shouldn&rsquo;t be here //</p>

<pre><code># The loopback network interface
auto lo
iface lo inet loopback
up route add -net 127.0.0.0 netmask 255.0.0.0 dev lo
down route add -net 127.0.0.0 netmask 255.0.0.0 dev lo

auto eth0
iface eth0 inet static
address 70.22.189.59
netmask 255.255.255.248
gateway 70.22.189.57
</code></pre>

<p>Now we will try to boot the system.</p>

<pre><code>cd $LXCDIR
lxc-start -n vm0
</code></pre>

<p>default password:</p>

<ul>
<li>user: root</li>
<li>password: root</li>
</ul>

<p>Tip: copy your ~/.ssh folder to each server for passwordless login</p>

<pre><code>nano /etc/default/locale
</code></pre>

<p>And add:</p>

<pre><code>LANG=en_US.UTF-8
</code></pre>

<p>Configure locales</p>

<pre><code>dpkg-reconfigure locales
</code></pre>

<p>Open  /etc/inittab and make sure you comment out like this:</p>

<pre><code>1:2345:respawn:/sbin/getty 38400 console
#c1:12345:respawn:/sbin/getty 38400 tty1 linux
#c2:12345:respawn:/sbin/getty 38400 tty2 linux
#c3:12345:respawn:/sbin/getty 38400 tty3 linux
#c4:12345:respawn:/sbin/getty 38400 tty4 linux
</code></pre>

<p>Now you should be at the vm0 login, try user root with pass root<br />
Try to ping a domain you know works, and it should give you a response otherwise your network setup failed.</p>

<p>Assuming it worked, let&rsquo;s make it permanent.</p>

<pre><code>ln -s $LXCDIR/vm0/config /etc/lxc/vm0.conf
</code></pre>

<p>Turn this on and add vm0 to the container variable.</p>

<pre><code>cd /etc/default/
nano lxc
</code></pre>

<p>Next we will setup the server:</p>

<h2>LXC Debian Server Setup</h2>

<hr />

<p>Useful Resources:</p>

<p><a href="http://lxc.teegra.net">teegra.net</a></p>

<p><a href="http://www.linuxfoundation.org/collaborate/workgroups/networking">linuxfoundation.org</a></p>

<p><a href="http://wiki.debian.org/HighPerformanceComputing">wiki.debian.org</a></p>

<p><a href="http://qemu-buch.de">qemu-buch.de</a></p>

<p><a href="http://nigel.mcnie.name/blog/a-five-minute-guide-to-linux-containers-for-debian">nigel.mcnie.name</a></p>

<p>Found another approach which looks interesting<br />
<a href="http://wiki.pcprobleemloos.nl/using_lxc_linux_containers_on_debian_squeeze/creating_a_lxc_virtual_machine_template">wiki.pcprobleemloos.nl</a></p>

  </div>
  <div class="panel-footer">
    <div class="btn-group">
      
      <a href="http://www.robotamer.com/tags/linux.html"><button type="button" class="btn btn-info btn-xs">linux</button></a>	
      
      <a href="http://www.robotamer.com/tags/howto.html"><button type="button" class="btn btn-info btn-xs">howto</button></a>	
      
      <a href="http://www.robotamer.com/tags/lxc.html"><button type="button" class="btn btn-info btn-xs">lxc</button></a>	
      
    </div>  
  </div>
</div>
 
        </div>
      </div>
    </div>

    <div class="container">
      <hr>
      <footer id="footer">
        Copyright &copy; 1998 - 2013 RoboTamer
        <span class="right">


          <a href="http://www.robotamer.com/blog.xml" rel="alternate" type="application/rss+xml">
            <img src="/static/ico/feed16x16.png" alt="" style="vertical-align:middle;border:0"/>
          </a>&nbsp;

          <a href="http://feedburner.google.com" target="_blank">
            <img src="//feedburner.google.com/fb/images/pub/powered_by_fb.gif" alt="Powered by FeedBurner" style="border:0"/>
          </a>

        </span>

      </footer>
    </div>
      <script src="/static/js/jquery.js"></script>
      <script src="/static/js/bootstrap.min.js"></script>
    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-33624274-1', 'robotamer.com');
  ga('send', 'pageview');
</script>

  </body>

</html>
